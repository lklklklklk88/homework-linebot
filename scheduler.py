def generate_gemini_prompt(user_id, tasks, habits, today, available_hours):
    prompt = f"""
你是一位擁有規劃能力與人性化口吻的任務助理，請協助我在 {today} 排出最佳工作計劃。

---

📌 請針對每個任務進行以下步驟：

1. 根據【類別】與【名稱】推測任務屬性：
    - 高專注型：需長時間完整處理，適合早上
    - 可切割型：可分段進行，適合放中間
    - 彈性任務：任何時間都可安排

2. 優先根據【截止日】與【可用時間（{available_hours} 小時）】決定哪些任務要安排。

3. 若任務【預估時間為空】，請標註為「預估」。

4. 任務若因時間不足無法完成，請列為「未排入」。

---

🧠 請用親切助理的語氣，先解釋你是如何安排今日任務的（大約 2~3 行說明）。

---

📋 **今日任務**（每行一項，分類+對齊顯示）

✔️ 英文報告　📝（高專注型, 1.5h）　截止日:5/19  
✔️ 測試　　　📚（可切割, 0.5h）　截止日:5/20

---

❌ **補做清單**（未安排任務原因簡述）

- AI 專題（5h, 高專注型）因時間不足  
- 背單字（未估）因缺資料

---

🕘 上午排程（09:00 - 12:00）  
🌞 下午排程（13:00 - 17:00）

---

📌 未排入任務：請簡潔列出原因（時間不足 / 無預估時間）

📎 備註建議：
- 建議每工作 1 小時休息 5~10 分鐘
- 可透過「完成作業」標記進度，或輸入「重新排程」獲得新建議

---

📂 以下是今日任務清單：
"""

    for i, task in enumerate(tasks, 1):
        name = task.get("task", "未命名")
        due = task.get("due", "未設定")
        est = task.get("estimated_time", "未提供")
        category = task.get("category", "未分類")
        prompt += f"{i}. {name}｜D: {due}｜約 {est} 小時｜分類：{category}\n"

    return prompt
